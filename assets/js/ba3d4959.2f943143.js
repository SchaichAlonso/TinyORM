"use strict";(self.webpackChunktinyorm_org=self.webpackChunktinyorm_org||[]).push([[784],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>c});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),m=p(n),c=i,h=m["".concat(l,".").concat(c)]||m[c]||u[c]||r;return n?a.createElement(h,o(o({ref:t},d),{},{components:n})):a.createElement(h,o({ref:t},d))}));function c(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var p=2;p<r;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},5162:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(7294),i=n(6010);const r="tabItem_Ymn6";function o(e){let{children:t,hidden:n,className:o}=e;return a.createElement("div",{role:"tabpanel",className:(0,i.Z)(r,o),hidden:n},t)}},5488:(e,t,n)=>{n.d(t,{Z:()=>c});var a=n(7462),i=n(7294),r=n(6010),o=n(2389),s=n(7392),l=n(7094),p=n(2466);const d="tabList__CuJ",u="tabItem_LNqP";function m(e){var t;const{lazy:n,block:o,defaultValue:m,values:c,groupId:h,className:k}=e,g=i.Children.map(e.children,(e=>{if((0,i.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),b=c??g.map((e=>{let{props:{value:t,label:n,attributes:a}}=e;return{value:t,label:n,attributes:a}})),y=(0,s.l)(b,((e,t)=>e.value===t.value));if(y.length>0)throw new Error(`Docusaurus error: Duplicate values "${y.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const f=null===m?m:m??(null==(t=g.find((e=>e.props.default)))?void 0:t.props.value)??g[0].props.value;if(null!==f&&!b.some((e=>e.value===f)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${f}" but none of its children has the corresponding value. Available values are: ${b.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:v,setTabGroupChoices:N}=(0,l.U)(),[S,C]=(0,i.useState)(f),q=[],{blockElementScrollPositionUntilNextRender:Q}=(0,p.o5)();if(null!=h){const e=v[h];null!=e&&e!==S&&b.some((t=>t.value===e))&&C(e)}const w=e=>{const t=e.currentTarget,n=q.indexOf(t),a=b[n].value;a!==S&&(Q(t),C(a),null!=h&&N(h,String(a)))},L=e=>{var t;let n=null;switch(e.key){case"Enter":w(e);break;case"ArrowRight":{const t=q.indexOf(e.currentTarget)+1;n=q[t]??q[0];break}case"ArrowLeft":{const t=q.indexOf(e.currentTarget)-1;n=q[t]??q[q.length-1];break}}null==(t=n)||t.focus()};return i.createElement("div",{className:(0,r.Z)("tabs-container",d)},i.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":o},k)},b.map((e=>{let{value:t,label:n,attributes:o}=e;return i.createElement("li",(0,a.Z)({role:"tab",tabIndex:S===t?0:-1,"aria-selected":S===t,key:t,ref:e=>q.push(e),onKeyDown:L,onClick:w},o,{className:(0,r.Z)("tabs__item",u,null==o?void 0:o.className,{"tabs__item--active":S===t})}),n??t)}))),n?(0,i.cloneElement)(g.filter((e=>e.props.value===S))[0],{className:"margin-top--md"}):i.createElement("div",{className:"margin-top--md"},g.map(((e,t)=>(0,i.cloneElement)(e,{key:t,hidden:e.props.value!==S})))))}function c(e){const t=(0,o.Z)();return i.createElement(m,(0,a.Z)({key:String(t)},e))}},2044:(e,t,n)=>{n.d(t,{Ae:()=>u,C:()=>p,Fo:()=>o,IM:()=>d,IZ:()=>a,RS:()=>h,al:()=>c,jk:()=>l,js:()=>s,q5:()=>r,qb:()=>m,wU:()=>i});const a="shell",i="application",r="bash",o="pwsh",s="zsh",l="application",p="bash",d="pwsh",u="zsh",m="TestApp",c="$HOME/Code/c/",h="$env:USERPROFILE\\Code\\c\\"},1935:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>p,default:()=>h,frontMatter:()=>l,metadata:()=>d,toc:()=>m});var a=n(7462),i=(n(7294),n(3905)),r=n(5162),o=n(5488),s=n(2044);const l={sidebar_position:0,sidebar_label:"Getting Started",description:"TinyORM makes interacting with a database extremely simple using raw SQL, a fluent query builder, and the TinyORM. It provides first-party support for three databases MySQL/MariaDB, PostgreSQL, and SQLite.",keywords:["c++ orm","database","getting started","tinyorm"]},p="Database: Getting Started",d={unversionedId:"database/getting-started",id:"database/getting-started",title:"Database: Getting Started",description:"TinyORM makes interacting with a database extremely simple using raw SQL, a fluent query builder, and the TinyORM. It provides first-party support for three databases MySQL/MariaDB, PostgreSQL, and SQLite.",source:"@site/docs/database/getting-started.mdx",sourceDirName:"database",slug:"/database/getting-started",permalink:"/database/getting-started",draft:!1,editUrl:"https://github.com/silverqx/TinyORM-github.io/edit/main/docs/database/getting-started.mdx",tags:[],version:"current",sidebarPosition:0,frontMatter:{sidebar_position:0,sidebar_label:"Getting Started",description:"TinyORM makes interacting with a database extremely simple using raw SQL, a fluent query builder, and the TinyORM. It provides first-party support for three databases MySQL/MariaDB, PostgreSQL, and SQLite.",keywords:["c++ orm","database","getting started","tinyorm"]},sidebar:"tinyormSidebar",previous:{title:"\ud83d\ude80 Supported Compilers",permalink:"/supported-compilers"},next:{title:"Query Builder",permalink:"/database/query-builder"}},u={},m=[{value:"Introduction",id:"introduction",level:2},{value:"Configuration",id:"configuration",level:3},{value:"SQLite Configuration",id:"sqlite-configuration",level:4},{value:"SSL Connections",id:"ssl-connections",level:3},{value:"MySQL",id:"mysql",level:5},{value:"PostgreSQL",id:"postgresql",level:5},{value:"Running SQL Queries",id:"running-sql-queries",level:2},{value:"Running A Select Query",id:"running-a-select-query",level:4},{value:"Selecting Scalar Values",id:"selecting-scalar-values",level:4},{value:"Running An Insert Statement",id:"running-an-insert-statement",level:4},{value:"Running An Update Statement",id:"running-an-update-statement",level:4},{value:"Running A Delete Statement",id:"running-a-delete-statement",level:4},{value:"Running A General Statement",id:"running-a-general-statement",level:4},{value:"Running An Unprepared Statement",id:"running-an-unprepared-statement",level:4},{value:"Implicit Commits",id:"implicit-commits",level:4},{value:"Using Multiple Database Connections",id:"using-multiple-database-connections",level:3},{value:"Database Transactions",id:"database-transactions",level:2},{value:"Manually Using Transactions",id:"manually-using-transactions",level:4},{value:"Multi-threading support",id:"multi-threading-support",level:2}],c={toc:m};function h(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"database-getting-started"},"Database: Getting Started"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#introduction"},"Introduction"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#configuration"},"Configuration")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#ssl-connections"},"SSL Connections")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#running-sql-queries"},"Running SQL Queries"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#using-multiple-database-connections"},"Using Multiple Database Connections")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#database-transactions"},"Database Transactions")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#multi-threading-support"},"Multi-threading support"))),(0,i.kt)("h2",{id:"introduction"},"Introduction"),(0,i.kt)("p",null,"Almost every modern application interacts with a database. TinyORM makes interacting with a database extremely simple using raw SQL, a ",(0,i.kt)("a",{parentName:"p",href:"/database/query-builder"},"fluent query builder"),", and the ",(0,i.kt)("a",{parentName:"p",href:"/tinyorm/getting-started"},"TinyORM"),". Currently, TinyORM provides first-party support for three databases:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"MySQL 5.7+ (",(0,i.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/MySQL#Release_history"},"Version Policy"),")"),(0,i.kt)("li",{parentName:"ul"},"MariaDB 10.3+ (",(0,i.kt)("a",{parentName:"li",href:"https://mariadb.org/about/#maintenance-policy"},"Version Policy"),")"),(0,i.kt)("li",{parentName:"ul"},"PostgreSQL 11+ (",(0,i.kt)("a",{parentName:"li",href:"https://www.postgresql.org/support/versioning/"},"Version Policy"),")"),(0,i.kt)("li",{parentName:"ul"},"SQLite 3.8.8+")),(0,i.kt)("p",null,"TinyORM internally uses ",(0,i.kt)("inlineCode",{parentName:"p"},"QtSql")," module, you can look for ",(0,i.kt)("a",{parentName:"p",href:"https://doc.qt.io/qt/sql-driver.html#supported-databases"},"supported databases"),"."),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"TinyORM's code is ready and designed to simply add support for the  SQL Server.")),(0,i.kt)("h3",{id:"configuration"},"Configuration"),(0,i.kt)("p",null,"You can create and configure new database connection by ",(0,i.kt)("inlineCode",{parentName:"p"},"create")," method provided by ",(0,i.kt)("inlineCode",{parentName:"p"},"DB")," facade:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'#include <orm/db.hpp>\n\nusing Orm::DB;\n\n// Ownership of a shared_ptr()\nauto manager = DB::create({\n    {"driver",          "QMYSQL"},\n    {"host",            qEnvironmentVariable("DB_HOST", "127.0.0.1")},\n    {"port",            qEnvironmentVariable("DB_PORT", "3306")},\n    {"database",        qEnvironmentVariable("DB_DATABASE", "")},\n    {"username",        qEnvironmentVariable("DB_USERNAME", "root")},\n    {"password",        qEnvironmentVariable("DB_PASSWORD", "")},\n    {"charset",         qEnvironmentVariable("DB_CHARSET", "utf8mb4")},\n    {"collation",       qEnvironmentVariable("DB_COLLATION", "utf8mb4_0900_ai_ci")},\n    {"timezone",        "+00:00"},\n    {"prefix",          ""},\n    {"strict",          true},\n    {"engine",          InnoDB},\n    {"version",         {}}, // Autodetect\n    {"options",         QVariantHash()},\n    {"prefix_indexes",  true},\n    {"isolation_level", "REPEATABLE READ"},\n});\n')),(0,i.kt)("p",null,"The first argument is configuration hash which is of type ",(0,i.kt)("inlineCode",{parentName:"p"},"QVariantHash")," and the second argument specifies the name of the ",(0,i.kt)("em",{parentName:"p"},"connection"),", this connection will also be a ",(0,i.kt)("em",{parentName:"p"},"default connection"),". You can configure multiple database connections at once and choose the needed one before executing SQL query, section ",(0,i.kt)("a",{parentName:"p",href:"#using-multiple-database-connections"},"Using Multiple Database Connections")," describes how to create and use multiple database connections."),(0,i.kt)("p",null,"You may also configure connection options by ",(0,i.kt)("inlineCode",{parentName:"p"},"options")," key as ",(0,i.kt)("inlineCode",{parentName:"p"},"QVariantHash")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"QString"),", you can pass any ",(0,i.kt)("a",{parentName:"p",href:"https://doc.qt.io/qt/qsqldatabase.html#setConnectOptions"},"connection options")," supported by ",(0,i.kt)("inlineCode",{parentName:"p"},"QSqlDatabase"),"."),(0,i.kt)("p",null,"You can also configure ",(0,i.kt)("a",{parentName:"p",href:"https://dev.mysql.com/doc/refman/8.0/en/innodb-transaction-isolation-levels.html"},"Transaction Isolation Levels")," for MySQL connection with the ",(0,i.kt)("inlineCode",{parentName:"p"},"isolation_level")," configuration option."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"version")," option is relevant only for the MySQL connections and you can save/avoid one database query (select version()) if you provide it manually. On the base of this version will be decided which ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/silverqx/TinyORM/blob/main/src/orm/connectors/mysqlconnector.cpp#L183"},"session variables")," will be set if strict mode is enabled and whether to use an ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/silverqx/TinyORM/blob/main/src/orm/query/grammars/mysqlgrammar.cpp#L32"},"alias")," during the ",(0,i.kt)("inlineCode",{parentName:"p"},"upsert")," method call."),(0,i.kt)("p",null,"Breaking values are as follows; use an upsert alias on the MySQL >=8.0.19 and remove the ",(0,i.kt)("inlineCode",{parentName:"p"},"NO_AUTO_CREATE_USER")," sql mode on the MySQL >=8.0.11 if the strict mode is enabled."),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"A database connection is resolved lazily, which means that the connection configuration is only saved after the ",(0,i.kt)("inlineCode",{parentName:"p"},"DB::create")," method call. The connection will be resolved after you run some query or you can create it using the ",(0,i.kt)("inlineCode",{parentName:"p"},"DB::connection")," method.")),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"You can also use predefined string constants to avoid unnecessary ",(0,i.kt)("inlineCode",{parentName:"p"},"QString")," instantiations, as used in the ",(0,i.kt)("inlineCode",{parentName:"p"},"tom")," migrations ",(0,i.kt)("a",{parentName:"p",href:"/building/migrations#string-constants-example"},"example"),".")),(0,i.kt)("h4",{id:"sqlite-configuration"},"SQLite Configuration"),(0,i.kt)("p",null,"SQLite databases are contained within a single file on your filesystem. You can create a new SQLite database using the ",(0,i.kt)("inlineCode",{parentName:"p"},"touch")," command in your terminal: ",(0,i.kt)("inlineCode",{parentName:"p"},"touch database.sqlite3"),". After the database has been created, you may configure SQLite database connection:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'#include <orm/db.hpp>\n\n// Ownership of a shared_ptr()\nauto manager = DB::create({\n    {"driver",    "QSQLITE"},\n    {"database",  qEnvironmentVariable("DB_DATABASE", "/absolute/path/to/database.sqlite3")},\n    {"foreign_key_constraints", qEnvironmentVariable("DB_FOREIGN_KEYS", "true")},\n    {"check_database_exists",   true},\n    {"prefix",                  ""},\n});\n')),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"database")," configuration value is the absolute path to the database. To enable foreign key constraints for SQLite connections, you should set the ",(0,i.kt)("inlineCode",{parentName:"p"},"foreign_key_constraints")," configuration value to ",(0,i.kt)("inlineCode",{parentName:"p"},"true"),", if this configuration value is not set, then the default of the SQLite driver will be used."),(0,i.kt)("p",null,"If the ",(0,i.kt)("inlineCode",{parentName:"p"},"check_database_exists")," configuration value is set to the ",(0,i.kt)("inlineCode",{parentName:"p"},"true")," value, then the database connection throws an ",(0,i.kt)("inlineCode",{parentName:"p"},"Orm::InvalidArgumentError")," exception, when the SQLite database file doesn't exist. If it is set to the ",(0,i.kt)("inlineCode",{parentName:"p"},"false")," value and the SQLite database file doesn't exist, then it will be created for you by SQLite driver. The default value is ",(0,i.kt)("inlineCode",{parentName:"p"},"true"),"."),(0,i.kt)("h3",{id:"ssl-connections"},"SSL Connections"),(0,i.kt)("p",null,"SSL connections are supported for the ",(0,i.kt)("inlineCode",{parentName:"p"},"MySQL")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"PostgreSQL")," databases. They can be set using the ",(0,i.kt)("inlineCode",{parentName:"p"},"options")," configuration option."),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"This feature is heavily dependent on the underlying ",(0,i.kt)("inlineCode",{parentName:"p"},"QSqlDatabase")," module. What means that you can pass the same ",(0,i.kt)("a",{parentName:"p",href:"https://doc.qt.io/qt/qsqldatabase.html#setConnectOptions"},"connection options")," to the ",(0,i.kt)("inlineCode",{parentName:"p"},"TinyORM")," that the ",(0,i.kt)("inlineCode",{parentName:"p"},"QSqlDatabase")," accepts.")),(0,i.kt)("h5",{id:"mysql"},"MySQL"),(0,i.kt)("p",null,"You have to pass the ",(0,i.kt)("inlineCode",{parentName:"p"},"SSL_CA"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"SSL_CERT"),", and ",(0,i.kt)("inlineCode",{parentName:"p"},"SSL_KEY")," options."),(0,i.kt)(o.Z,{groupId:s.IZ,mdxType:"Tabs"},(0,i.kt)(r.Z,{value:s.Fo,label:s.IM,mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'#include <orm/db.hpp>\n\nusing Orm::DB;\n\n// Ownership of a shared_ptr()\nauto manager = DB::create({\n    {"driver",  "QMYSQL"},\n    {"host",    qEnvironmentVariable("DB_MYSQL_HOST", "127.0.0.1")},\n    ...\n    // highlight-start\n    {"options", QVariantHash({{"SSL_CA",   "C:/mysql/data/ca.pem"},\n                              {"SSL_CERT", "C:/mysql/data/client-cert.pem"},\n                              {"SSL_KEY",  "C:/mysql/data/client-key.pem"}})},\n    // highlight-end\n});\n'))),(0,i.kt)(r.Z,{value:s.q5,label:s.C,mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'#include <orm/db.hpp>\n\nusing Orm::DB;\n\n// Ownership of a shared_ptr()\nauto manager = DB::create({\n    {"driver",  "QMYSQL"},\n    {"host",    qEnvironmentVariable("DB_MYSQL_HOST", "127.0.0.1")},\n    ...\n    // highlight-start\n    {"options", QVariantHash({{"SSL_CA",   "~/.local/share/TinyORM/ssl/ca.pem"},\n                              {"SSL_CERT", "~/.local/share/TinyORM/ssl/client-cert.pem"},\n                              {"SSL_KEY",  "~/.local/share/TinyORM/ssl/client-key.pem"}})},\n    // highlight-end\n});\n')))),(0,i.kt)("p",null,"You may also use the ",(0,i.kt)("inlineCode",{parentName:"p"},"ConfigUtils::mysqlSslOptions()")," or the ",(0,i.kt)("inlineCode",{parentName:"p"},"ConfigUtils::insertMySqlSslOptions()")," methods to insert these options for you and define them using the ",(0,i.kt)("inlineCode",{parentName:"p"},"DB_MYSQL_SSL_CA"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"DB_MYSQL_SSL_CERT"),", and ",(0,i.kt)("inlineCode",{parentName:"p"},"DB_MYSQL_SSL_KEY")," environment variables."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'#include <orm/db.hpp>\n#include <orm/utils/configuration.hpp>\n\nusing Orm::DB;\n\nusing ConfigUtils = Orm::Utils::Configuration;\n\n// Ownership of a shared_ptr()\nauto manager = DB::create({\n    {"driver",  "QMYSQL"},\n    {"host",    qEnvironmentVariable("DB_MYSQL_HOST", "127.0.0.1")},\n    ...\n    // highlight-next-line\n    {"options", ConfigUtils::mysqlSslOptions()},\n});\n')),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"You can take a look at the GitHub actions how the ",(0,i.kt)("inlineCode",{parentName:"p"},"MySQL")," certificates are generated in the CI pipeline for ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/silverqx/TinyORM/blob/main/.github/workflows/msvc2022-qt6.yml"},"Windows")," and ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/silverqx/TinyORM/blob/main/.github/workflows/linux-qt6.yml"},"Linux"),".")),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"You can also pass the ",(0,i.kt)("inlineCode",{parentName:"p"},"QString")," to the ",(0,i.kt)("inlineCode",{parentName:"p"},"options")," configuration separated by the ",(0,i.kt)("inlineCode",{parentName:"p"},";")," semicolon character and using the ",(0,i.kt)("inlineCode",{parentName:"p"},"=")," to assign values.")),(0,i.kt)("h5",{id:"postgresql"},"PostgreSQL"),(0,i.kt)("p",null,"You have to pass the ",(0,i.kt)("a",{parentName:"p",href:"https://www.postgresql.org/docs/current/libpq-ssl.html#LIBPQ-SSL-SSLMODE-STATEMENTS"},(0,i.kt)("inlineCode",{parentName:"a"},"sslmode"))," or the deprecated ",(0,i.kt)("a",{parentName:"p",href:"https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNECT-REQUIRESSL"},(0,i.kt)("inlineCode",{parentName:"a"},"requiressl"))," options."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'#include <orm/db.hpp>\n\nusing Orm::DB;\n\n// Ownership of a shared_ptr()\nauto manager = DB::create({\n    {"driver",  "QPSQL"},\n    {"host",    qEnvironmentVariable("DB_PGSQL_HOST", "127.0.0.1")},\n    ...\n    // highlight-next-line\n    {"options", QVariantHash({{"sslmode", "verify-full"}})},\n});\n')),(0,i.kt)("p",null,"And place your ",(0,i.kt)("strong",{parentName:"p"},"client")," certificates to the ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.postgres/")," on ",(0,i.kt)("a",{parentName:"p",href:"https://www.postgresql.org/docs/current/libpq-ssl.html#LIBPQ-SSL-FILE-USAGE"},"Linux")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"$env:APPDATA/postgres/")," on Windows. Everything is described in the PostgreSQL's ",(0,i.kt)("a",{parentName:"p",href:"https://www.postgresql.org/docs/current/libpq-ssl.html"},"libpq client")," and ",(0,i.kt)("a",{parentName:"p",href:"https://www.postgresql.org/docs/15/ssl-tcp.html#SSL-FILE-USAGE"},"server")," documentation."),(0,i.kt)("p",null,"You may also use the ",(0,i.kt)("inlineCode",{parentName:"p"},"ConfigUtils::postgresSslOptions()")," or the ",(0,i.kt)("inlineCode",{parentName:"p"},"ConfigUtils::insertPostgresSslOptions()")," methods to insert the ",(0,i.kt)("inlineCode",{parentName:"p"},"sslmode")," option for you and define it using the ",(0,i.kt)("inlineCode",{parentName:"p"},"DB_PGSQL_SSLMODE")," environment variable."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'#include <orm/db.hpp>\n#include <orm/utils/configuration.hpp>\n\nusing Orm::DB;\n\nusing ConfigUtils = Orm::Utils::Configuration;\n\n// Ownership of a shared_ptr()\nauto manager = DB::create({\n    {"driver",  "QPSQL"},\n    {"host",    qEnvironmentVariable("DB_PGSQL_HOST", "127.0.0.1")},\n    ...\n    // highlight-next-line\n    {"options", ConfigUtils::postgresSslOptions()},\n});\n')),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"The PostgreSQL's libpq client library provides the ",(0,i.kt)("a",{parentName:"p",href:"https://www.postgresql.org/docs/current/libpq-envars.html#id-1.7.3.22.3.4.13.1.1"},(0,i.kt)("inlineCode",{parentName:"a"},"PGSSLMODE"))," environment variable, so don't have to use TinyORM's ",(0,i.kt)("inlineCode",{parentName:"p"},"options")," configuration and use the ",(0,i.kt)("inlineCode",{parentName:"p"},"PGSSLMODE")," instead.")),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"You can take a look at the GitHub actions how the ",(0,i.kt)("inlineCode",{parentName:"p"},"PostgreSQL")," certificates are generated in the CI pipeline for ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/silverqx/TinyORM/blob/main/.github/workflows/msvc2022-qt6.yml"},"Windows")," and ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/silverqx/TinyORM/blob/main/.github/workflows/linux-qt6.yml"},"Linux"),".")),(0,i.kt)("h2",{id:"running-sql-queries"},"Running SQL Queries"),(0,i.kt)("p",null,"Once you have configured your database connection, you may run queries using the ",(0,i.kt)("inlineCode",{parentName:"p"},"DB")," facade. The ",(0,i.kt)("inlineCode",{parentName:"p"},"DB")," facade provides methods for each type of query: ",(0,i.kt)("inlineCode",{parentName:"p"},"select"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"update"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"insert"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"delete"),", and ",(0,i.kt)("inlineCode",{parentName:"p"},"statement"),"."),(0,i.kt)("h4",{id:"running-a-select-query"},"Running A Select Query"),(0,i.kt)("p",null,"To run a basic SELECT query, you may use the ",(0,i.kt)("inlineCode",{parentName:"p"},"select")," method on the ",(0,i.kt)("inlineCode",{parentName:"p"},"DB")," facade:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'auto users = DB::select("select * from users where active = ?", {1});\n')),(0,i.kt)("p",null,"The first argument passed to the ",(0,i.kt)("inlineCode",{parentName:"p"},"select")," method is the SQL query, while the second argument is any parameter bindings that need to be bound to the query. Typically, these are the values of the ",(0,i.kt)("inlineCode",{parentName:"p"},"where")," clause constraints. Parameter binding provides protection against SQL injection."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"select")," method returns a ",(0,i.kt)("inlineCode",{parentName:"p"},"QSqlQuery")," containing the results of the query, where each result can be accessed by ",(0,i.kt)("inlineCode",{parentName:"p"},"QSqlQuery::next")," method. Look into the ",(0,i.kt)("inlineCode",{parentName:"p"},"QSqlQuery"),' documentation on how to obtain results from the "query". You may access each column\'s value by ',(0,i.kt)("inlineCode",{parentName:"p"},"QSqlQuery::value")," method. The first ",(0,i.kt)("inlineCode",{parentName:"p"},"bool")," return value is the value returned from ",(0,i.kt)("inlineCode",{parentName:"p"},"QSqlQuery::exec")," method:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'#include <QDebug>\n\n#include <orm/db.hpp>\n\nauto users = DB::select("select * from users");\n\nwhile(users.next())\n    qDebug() << users.value("name").toString();\n')),(0,i.kt)("h4",{id:"selecting-scalar-values"},"Selecting Scalar Values"),(0,i.kt)("p",null,"Sometimes your database query may result in a single, scalar value. Instead of being required to retrieve the query's scalar result from a record instance, TinyORM allows you to retrieve this value directly using the ",(0,i.kt)("inlineCode",{parentName:"p"},"scalar")," shortcut method:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'#include <orm/db.hpp>\n\nauto states = DB::scalar(\n    "select count(case when state = \'pending\' then 1 end) as states "\n      "from comments"\n);\n\n// With binding\nauto states = DB::scalar(\n    "select count(case when state = ? then 1 end) as states from comments",\n    {"pending"}\n);\n')),(0,i.kt)("h4",{id:"running-an-insert-statement"},"Running An Insert Statement"),(0,i.kt)("p",null,"To execute an ",(0,i.kt)("inlineCode",{parentName:"p"},"insert")," statement, you may use the ",(0,i.kt)("inlineCode",{parentName:"p"},"insert")," method on the ",(0,i.kt)("inlineCode",{parentName:"p"},"DB")," facade. Like ",(0,i.kt)("inlineCode",{parentName:"p"},"select"),", this method accepts the SQL query as its first argument and bindings as its second argument and returns ",(0,i.kt)("inlineCode",{parentName:"p"},"QSqlQuery"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'#include <orm/db.hpp>\n\nDB::insert("insert into users (id, name) values (?, ?)", {1, "Marc"});\n')),(0,i.kt)("h4",{id:"running-an-update-statement"},"Running An Update Statement"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"update")," method should be used to update existing records in the database. The number of rows affected by the statement and ",(0,i.kt)("inlineCode",{parentName:"p"},"QSqlQuery")," is returned by the method as ",(0,i.kt)("inlineCode",{parentName:"p"},"std::tuple<int, QSqlQuery>"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'#include <QDateTime>\n\n#include <orm/db.hpp>\n\nauto [affected, query] = DB::update(\n    "update users set updated_at = ? where name = ?",\n    {QDateTime::currentDateTimeUtc(), "Anita"}\n);\n\nif (!affected)\n    qDebug() << "Any record was updated.";\n')),(0,i.kt)("h4",{id:"running-a-delete-statement"},"Running A Delete Statement"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"remove")," method should be used to delete records from the database. Like ",(0,i.kt)("inlineCode",{parentName:"p"},"update"),", the number of affected rows and ",(0,i.kt)("inlineCode",{parentName:"p"},"QSqlQuery")," will be returned by the method as ",(0,i.kt)("inlineCode",{parentName:"p"},"std::tuple<int, QSqlQuery>"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'#include <orm/db.hpp>\n\nauto [affected, query] = DB::remove("delete from users");\n')),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("inlineCode",{parentName:"p"},"delete")," can not be used as the method name because it is the reserved word.")),(0,i.kt)("h4",{id:"running-a-general-statement"},"Running A General Statement"),(0,i.kt)("p",null,"Some database statements do not return any value. For these types of operations, you may use the ",(0,i.kt)("inlineCode",{parentName:"p"},"statement")," method on the ",(0,i.kt)("inlineCode",{parentName:"p"},"DB")," facade:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'DB::statement("drop table users");\n')),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("inlineCode",{parentName:"p"},"DB::statement")," method should be used for ",(0,i.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Data_definition_language"},"DDL"),' queries, don\'t use it for "select" queries because it internally calls ',(0,i.kt)("inlineCode",{parentName:"p"},"recordsHaveBeenModified")," method.")),(0,i.kt)("h4",{id:"running-an-unprepared-statement"},"Running An Unprepared Statement"),(0,i.kt)("p",null,"Sometimes you may want to execute an SQL statement without binding any values. You may use the ",(0,i.kt)("inlineCode",{parentName:"p"},"DB")," facade's ",(0,i.kt)("inlineCode",{parentName:"p"},"unprepared")," method to accomplish this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"DB::unprepared(\"update users set votes = 100 where name = 'Dries'\");\n")),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"Since unprepared statements do not bind parameters, they may be vulnerable to SQL injection. You should never allow user controlled values within an unprepared statement.")),(0,i.kt)("h4",{id:"implicit-commits"},"Implicit Commits"),(0,i.kt)("p",null,"When using the ",(0,i.kt)("inlineCode",{parentName:"p"},"DB")," facade's ",(0,i.kt)("inlineCode",{parentName:"p"},"statement")," methods within transactions, you must be careful to avoid statements that cause ",(0,i.kt)("a",{parentName:"p",href:"https://dev.mysql.com/doc/refman/8.0/en/implicit-commit.html"},"implicit commits"),". These statements will cause the database engine to indirectly commit the entire transaction, leaving TinyORM unaware of the database's transaction level. An example of such a statement is creating a database table:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'DB::statement("create table users (name varchar(255) null)");\n')),(0,i.kt)("p",null,"Please refer to the MySQL manual for ",(0,i.kt)("a",{parentName:"p",href:"https://dev.mysql.com/doc/refman/8.0/en/implicit-commit.html"},"a list of all statements")," that trigger implicit commits."),(0,i.kt)("h3",{id:"using-multiple-database-connections"},"Using Multiple Database Connections"),(0,i.kt)("p",null,"You can configure multiple database connections at once during ",(0,i.kt)("inlineCode",{parentName:"p"},"DatabaseManager")," instantiation using the ",(0,i.kt)("inlineCode",{parentName:"p"},"DB::create")," overload, where the first argument is a hash of multiple connections and is of type ",(0,i.kt)("inlineCode",{parentName:"p"},"QHash<QString, QVariantHash>")," and the second argument is the name of the default connection:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'#include <orm/db.hpp>\n\n// Ownership of a shared_ptr()\nauto manager = DB::create({\n    {"mysql", {\n        {"driver",    "QMYSQL"},\n        {"host",      qEnvironmentVariable("DB_MYSQL_HOST", "127.0.0.1")},\n        {"port",      qEnvironmentVariable("DB_MYSQL_PORT", "3306")},\n        {"database",  qEnvironmentVariable("DB_MYSQL_DATABASE", "")},\n        {"username",  qEnvironmentVariable("DB_MYSQL_USERNAME", "root")},\n        {"password",  qEnvironmentVariable("DB_MYSQL_PASSWORD", "")},\n        {"charset",   qEnvironmentVariable("DB_MYSQL_CHARSET", "utf8mb4")},\n        {"collation", qEnvironmentVariable("DB_MYSQL_COLLATION", "utf8mb4_0900_ai_ci")},\n        {"strict",    true},\n        {"options",   QVariantHash()},\n    }},\n    {"sqlite", {\n        {"driver",    "QSQLITE"},\n        {"database",  qEnvironmentVariable("DB_SQLITE_DATABASE", "")},\n        {"foreign_key_constraints", qEnvironmentVariable("DB_SQLITE_FOREIGN_KEYS", "true")},\n        {"check_database_exists",   true},\n        {"prefix",                  ""},\n    }},\n}, "mysql");\n')),(0,i.kt)("p",null,"If your application needs to use multiple connections, you may access each connection via the ",(0,i.kt)("inlineCode",{parentName:"p"},"connection")," method provided by the ",(0,i.kt)("inlineCode",{parentName:"p"},"DB")," facade. The connection name passed to the ",(0,i.kt)("inlineCode",{parentName:"p"},"connection")," method should correspond to one of the connections key listed in your configuration:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'#include <orm/db.hpp>\n\nauto query = DB::connection("mysql_test").select(...);\n')),(0,i.kt)("p",null,"You may access the raw underlying ",(0,i.kt)("inlineCode",{parentName:"p"},"QSqlQuery")," instance of a connection using the ",(0,i.kt)("inlineCode",{parentName:"p"},"getQtQuery")," method on a connection instance:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"auto query = DB::connection().getQtQuery();\n")),(0,i.kt)("p",null,"Or you can use the shortcut method ",(0,i.kt)("inlineCode",{parentName:"p"},"qtQuery")," provided by the ",(0,i.kt)("inlineCode",{parentName:"p"},"DB")," facade:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"auto query = DB::qtQuery();\n")),(0,i.kt)("h2",{id:"database-transactions"},"Database Transactions"),(0,i.kt)("h4",{id:"manually-using-transactions"},"Manually Using Transactions"),(0,i.kt)("p",null,"If you would like to begin a transaction manually and have complete control over rollbacks and commits, you may use the ",(0,i.kt)("inlineCode",{parentName:"p"},"beginTransaction")," method provided by the ",(0,i.kt)("inlineCode",{parentName:"p"},"DB")," facade:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"#include <orm/db.hpp>\n\nDB::beginTransaction();\n")),(0,i.kt)("p",null,"You can rollback the transaction via the ",(0,i.kt)("inlineCode",{parentName:"p"},"rollBack")," method:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"DB::rollBack();\n")),(0,i.kt)("p",null,"Lastly, you can commit a transaction via the ",(0,i.kt)("inlineCode",{parentName:"p"},"commit")," method:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"DB::commit();\n")),(0,i.kt)("p",null,"All transaction methods accept a connection name as the optional argument:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'DB::beginTransaction("mysql_test");\n')),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"The ",(0,i.kt)("inlineCode",{parentName:"p"},"DB")," facade's transaction methods control the transactions for both the ",(0,i.kt)("a",{parentName:"p",href:"/database/query-builder"},"query builder")," and ",(0,i.kt)("a",{parentName:"p",href:"/tinyorm/getting-started"},"TinyORM"),".")),(0,i.kt)("h2",{id:"multi-threading-support"},"Multi-threading support"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"TinyORM")," supports multi-threading for the ",(0,i.kt)("inlineCode",{parentName:"p"},"MSVC")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"GCC")," on Linux compilers. Multi-threading is disabled for the ",(0,i.kt)("inlineCode",{parentName:"p"},"Clang <14.0.3")," compiler on MSYS2, ",(0,i.kt)("inlineCode",{parentName:"p"},"Clang <14.0.4")," on Linux and for the ",(0,i.kt)("inlineCode",{parentName:"p"},"GCC")," compiler on MSYS2. The reason are bugs in the ",(0,i.kt)("inlineCode",{parentName:"p"},"TLS")," wrapper that is generated by the ",(0,i.kt)("a",{parentName:"p",href:"https://en.cppreference.com/w/cpp/keyword/thread_local"},(0,i.kt)("inlineCode",{parentName:"a"},"thread_local"))," keyword."),(0,i.kt)("p",null,"A connection can only be used from within the thread that created it. Moving connections between threads or creating queries from a different thread where the connection was created is not supported."),(0,i.kt)("p",null,"In addition, the third party libraries used by the ",(0,i.kt)("inlineCode",{parentName:"p"},"QSqlDrivers")," can impose further restrictions on using the SQL Module in a multithreaded program."),(0,i.kt)("p",null,"In short, if you create a ",(0,i.kt)("inlineCode",{parentName:"p"},"DB::connection")," in some thread then you have to use this connection only from this particular thread and of course all queries that will be executed on this connection."),(0,i.kt)("p",null,"If you want to execute some query from another thread for the same connection then you have to create a new connection first and if you have a new connection you can send a query from this new thread to the database."),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"The ",(0,i.kt)("a",{parentName:"p",href:"/database/migrations#tables"},(0,i.kt)("inlineCode",{parentName:"a"},"schema builder"))," and ",(0,i.kt)("a",{parentName:"p",href:"/database/migrations"},(0,i.kt)("inlineCode",{parentName:"a"},"migrations"))," don't support multi-threading.")))}h.isMDXComponent=!0}}]);